<html>
<head>
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<style>

body {
	background: 0 0;
	color: #3f4549;
	font-family: "Helvetica Neue",arial,sans-serif;
	font-size: 15px;
	-webkit-font-smoothing: antialiased;
}

.comments-box {
    border: 1px solid #bbb;
    margin: 20px;
}

.comments-box .comment-input {
    width: 80%;
}

.comments-box .comment-input-btn {
    width: 18%;
}

.comments-box .form-group * {
    width: 100%;
}

.comments-box .email-input,
.comments-box .name-input {
    width: 40%;
    margin-bottom: 10px;
}

.comments-list {
	margin: 0;
	padding: 0;
    list-style: none;
    overflow: auto;
}

.comment-single .comment-single {
	padding-left: 40px;
}

.comment-single .comment-container {
	padding: 15px 10px;
	border-bottom: 1px solid #ddd;
}

.comments-list li .comment-text,
.comments-list li .comment-image {
    display: block;
}

.comments-list li .comment-text {
    padding-left: 50px;
}

.comments-list .comment-form {
	display: none;
}

.comment-image {
    width: 40px;
    margin-right: 10px;
    height: 40px;
    float: left;
}

.comment-image img {
    width: 100%;
    border-radius: 50%;
}

.comment-text p {
    margin: 0;
}

.comment-heading {
    color: #aaa;
    font-size: 12px;
	margin-bottom: 5px;
	display: block;
}

.comment-heading .title {
	font-weight: 700;
	text-decoration: none;
	color: #288ce4;
	font-size: 13px;
}

.comment-heading .meta {
	margin-left: 5px;
	font-weight: 500;
	font-size: 12px;
	color: #a5b2b9;
}

.comment-single .comment-form {
	margin: 20px 0 0 0;
	padding-bottom: 0;
	border-bottom: 1px solid #ddd;
	padding: 10px;
	margin: 0;
}

.comment-form-container {
	margin: 20px;
}

.meta-buttons {
	margin-top: 10px;
}

.meta-buttons a {
    font-weight: bold;
    font-size: 11px;
	padding: 0 15px 0 0;
	color: #288ce4;
}

.meta-buttons .comment-votes {
	display: inline-block;
	margin-right: 15px;
}

.meta-buttons .comment-votes a {
	padding: 0 0 0 2px;
}

.meta-buttons .comment-votes .count {
	color: #a5b2b9;
	font-weight: 500;
	font-size: 13px;
	margin-right: 2px;
}

.meta-buttons .static-label {
	font-weight: bold;
	font-size: 11px;
	color: #a5b2b9;
}



.comment-heading .dropdown {
    float: right;
    margin-left: 50px;
}

.comment-heading .dropdown-toggle {
    font-weight: bold;
    font-size: 11px;
    color: #288ce4;
}

.comment-heading .dropdown-menu {
    right: 0;
    left: auto;
    min-width: 60px;
}

.comment-heading .dropdown-menu > li > a {
    font-weight: bold;
    font-size: 11px;
    color: #288ce4;
    padding: 5px 10px;
}

.comment-heading .dropdown-menu > li > span.comment-flag .glyphicon,
.comment-heading .dropdown-menu > li > a .glyphicon {
    padding-right: 5px;
}

.comment-heading .dropdown-menu > li > span.comment-flag {
    display: block;
    white-space: nowrap;
    color: #aaa;
    font-weight: bold;
    font-size: 11px;
    padding: 5px 10px;
}

</style>
</head>
<body>
	





{% set params = {
	order: 'dateCreated asc',
} %}

{{ craft.comments.form(entry, params) }}





<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script>
$( document ).ready(function() {
	$(document).on('submit', '.comment-form', function(e) {
	  e.preventDefault();

	  var data = $(this).serialize();

		$.ajax({
			method: 'POST',
			url: data.action,
			data: data,
			headers: {'Content-Type': 'application/x-www-form-urlencoded'}
		})
		.success(function(data) {
			console.log('success', data);
		})
		.error(function(data) {
			console.log('error', data);
		});
	});

	// toggle to show/hide comments
	$(document).on('click', 'a.comment-toggle', function(e) {
		e.preventDefault();

		$(this).parents('.comment-single:first').find('.comments-list:first').slideToggle();
	});

	// toggle to show/hide reply form
	$(document).on('click', 'a.comment-reply', function(e) {
		e.preventDefault();

		$element = $(this).parents('.comment-single:first');
		$element.find('form:first').slideToggle();
	});

    // Handle voting
    $(document).on('click', 'a.comment-vote-down, a.comment-vote-up', function(e) {
        e.preventDefault();

        $.ajax({
            url: $(this).attr('href'),
        })
        .success(function(data) {
            console.log('success', data);

            // update label
            if (data.success) {
                $(e.target).parent().parent().find('.count').html(data.votes + ' votes');
            }
        })
        .error(function(data) {
            console.log('error', data);
        });
    });

    // Handle flagging
    $(document).on('click', 'a.comment-flag', function(e) {
        e.preventDefault();

        $.ajax({
            url: $(this).attr('href'),
        })
        .success(function(data) {
            console.log('success', data);

            // update label
            $(e.target).parent().parent().find('.comment-flag').replaceWith('<span class="static-label comment-flag"><span class="glyphicon glyphicon-flag"></span>Flagged as inappropriate</span>');
        })
        .error(function(data) {
            console.log('error', data);
        });
    });

    // Handle deleting
    $(document).on('click', 'a.comment-delete', function(e) {
        e.preventDefault();

        $.ajax({
            url: $(this).attr('href'),
        })
        .success(function(data) {
            console.log('success', data);
        })
        .error(function(data) {
            console.log('error', data);
        });
    });

    // Handle editing
    $(document).on('click', 'a.comment-edit', function(e) {
        e.preventDefault();

        var comment_text = $.trim($(this).parents('.comment-text').find('.comment-content').text());
        var id = $(this).parents('.comment-single:first').data('id');
        var csrf = $('input[name="CRAFT_CSRF_TOKEN"]:first').val();

        var html = '';
        html += '<form class="edit-comment" role="form" method="post">';
        html += '<input type="hidden" name="action" value="comments/edit">';
        html += '<input type="hidden" name="commentId" value="'+id+'">';
        html += '<input type="hidden" name="CRAFT_CSRF_TOKEN" value="'+csrf+'">';
        html += '<textarea class="form-control" name="fields[comment]" rows="5">'+comment_text+'</textarea>';
        html += '<button class="btn btn-default">Save</button>';
        html += '</form>';

        $(this).parents('.comment-text').find('.comment-content').html(html);
    });

    $(document).on('submit', '.edit-comment', function(e) {
        e.preventDefault();

        var data = $(this).serialize();

        $.ajax({
            method: 'POST',
            url: data.action,
            data: data,
            headers: {'Content-Type': 'application/x-www-form-urlencoded'}
        })
        .success(function(data) {
            console.log('success', data);

            // remove the form
            var comment_text = $('form.edit-comment textarea[name="fields[comment]"]').val().replace(/\n/g, '<br />');

            $('form.edit-comment').parent().html('<p>'+comment_text+'</p>');
        })
        .error(function(data) {
            console.log('error', data);
        });
    });




});
</script>
</body>
</html>
